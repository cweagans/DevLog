<h1 id="configuration"><a aria-hidden="true" class="anchor-heading" href="#configuration"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Configuration</h1>
<h2 id="configuration-1"><a aria-hidden="true" class="anchor-heading" href="#configuration-1"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Configuration</h2>
<h3 id="updates-repository"><a aria-hidden="true" class="anchor-heading" href="#updates-repository"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Updates Repository</h3>
<p>For regular updates and to avoid errors set the updates repository from the enterprise proxmox repo (subscription required) to the <code>pve-no-subscription</code> repo.</p>
<p><img src="/DevLog/assets/images/2022-01-25-23-37-43.png" alt="repos"></p>
<ol>
<li>disable the enterprise repo</li>
<li><code>[Add]</code></li>
<li><code>pve-no-subscription</code></li>
<li>run <code>apt-get update; apt dist-upgrade; reboot</code></li>
</ol>
<h3 id="enable-iommu"><a aria-hidden="true" class="anchor-heading" href="#enable-iommu"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Enable IOMMU</h3>
<!-- markdownlint-disable MD031-->
<p>Enable <a href="/DevLog/notes/0xbcevuqumdxife2dxgb30y">iommu</a> so VM's can access hardware not made for virtualization (GPU's etc.)</p>
<ol>
<li>you can do this but updating the <code>/etc/default/grub</code> file
<ul>
<li>change <code>GRUB_CMDLINE_LINUX_ DEFAULT="quiet"</code></li>
<li>to: <code>GRUB_CMDLINE LINUX DEFAULT="quiet intel iommu=on"</code></li>
</ul>
</li>
<li>Then run <code>update-grub</code></li>
<li>Then edit <code>/etc/modules</code> Add these 4 lines to it:</li>
<li>
<pre class="language-txt"><code class="language-txt">`vfio`
`vfio_iommu_typel`
`vfio_pci`
`vfio_virqfd`
</code></pre>
</li>
<li>Then run <code>update-initramfs -u -k all</code></li>
<li>reboot</li>
</ol>
<!-- markdownlint-enable MD031-->
<h3 id="make-proxmox-vlan-aware"><a aria-hidden="true" class="anchor-heading" href="#make-proxmox-vlan-aware"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Make Proxmox VLAN aware</h3>
<ol>
<li>go to <code>System > Network</code></li>
<li>"Edit" your Linux bridge</li>
<li>check the box for <code>VLAN aware:</code></li>
<li>Click <code>Apply Configuration</code></li>
</ol>
<p>This will update <code>/etc/network/interfaces</code> with new settings and where it says <code>bridge-vids</code> you can change the default <code>2-4094</code> to be a single number for the <a href="/DevLog/notes/v9s04fmtizuk86nxjpv6354">VLAN</a> of the server, or do that for individual virtual machines</p>
<h3 id="setup-nfs-for-backups"><a aria-hidden="true" class="anchor-heading" href="#setup-nfs-for-backups"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Setup NFS for backups</h3>
<p>ACTIVE This setup</p>
<ol start="0">
<li>You need to have the <a href="/DevLog/notes/q4aac4wbg964ofeb5d6ytv6">Network File System</a> share already setup so <a href="/DevLog/notes/82umkyemhjtdlkjgew0a2km">Fafnir</a> needs to already be setup and mounted to the proxmox instance?</li>
<li><code>Datacenter node "> storage > add > nfs</code></li>
<li><code>ID</code> ==> "Backups"</li>
<li>Server IPV4 address (address to <a href="/DevLog/notes/82umkyemhjtdlkjgew0a2km">Fafnir</a>?)</li>
<li>Export <code>/mnt/storage &#x3C;++></code></li>
</ol>
<h4 id="schedule-backups"><a aria-hidden="true" class="anchor-heading" href="#schedule-backups"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Schedule Backups</h4>
<ol>
<li><code>Datacenter node > backup > add</code></li>
<li>Select Node to backup</li>
<li>Select storage share to send backups to</li>
<li>Schedule Backups</li>
<li>Email notification Settings</li>
<li>Compression level (ZSTD)</li>
<li>mode == snapshot</li>
<li>test it
<ol>
<li>make a backup immediately</li>
</ol>
</li>
</ol>
<h3 id="setup-linux-bridge-for-virtual-machines-separate-from-management-layer"><a aria-hidden="true" class="anchor-heading" href="#setup-linux-bridge-for-virtual-machines-separate-from-management-layer"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Setup Linux Bridge for Virtual Machines Separate from management Layer</h3>
<ol>
<li><code>pve node > System > Network > Create > Linux Bond</code></li>
<li><code>bond0</code></li>
<li>Give it a IPV4 address</li>
<li>List all the bridge ports in a space separated list</li>
<li>choose <a href="/DevLog/notes/051ngzwl2msbgfmws2hj4eq">3ad</a> mode for <a href="/DevLog/notes/lgl3co3ibveuv4ejvn2yso6">LACP</a></li>
<li>Add Comment</li>
</ol>
<h4 id="make-network-bridge-for-virtual-machines"><a aria-hidden="true" class="anchor-heading" href="#make-network-bridge-for-virtual-machines"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Make Network Bridge for Virtual Machines</h4>
<ul>
<li><a href="https://youtu.be/qTbeHpdHcqs">https://youtu.be/qTbeHpdHcqs</a></li>
</ul>
<ol>
<li><code>pve node > System > Network > Create > Linux Bridge</code></li>
<li><code>vmbr1</code> is fine</li>
<li>Give it a IPV4 address</li>
<li>make it <code>VLAN aware:</code></li>
<li>List all the bridge ports in a space separated list</li>
<li>Add Comment</li>
</ol>
<h3 id="download-windows-virtio-drivers"><a aria-hidden="true" class="anchor-heading" href="#download-windows-virtio-drivers"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Download Windows VirtIO drivers</h3>
<ol>
<li>Go To <a href="https://pve.proxmox.com/wiki/Windows_VirtIO_Drivers">This page</a></li>
<li>Click the link under <code>Installation</code> for downloading latest stable release</li>
<li>upload iso to proxmox iso's in <code>local > ISO images > Upload</code></li>
</ol>
<hr>
<strong>Backlinks</strong>
<ul>
<li><a href="/DevLog/notes/p4mog8mu5oi3u7tg97iwjb4">Setup (DevLog)</a></li>
</ul>